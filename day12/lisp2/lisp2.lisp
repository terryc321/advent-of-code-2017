;;;; lisp2.lisp

(in-package #:lisp2)

;; relative paths are a disaster , what is it relative to ? whenever slime starts it balks off
;; (uiop:getcwd)
;; (sb-posix:getcwd)
;;
;; give same result #P"/home/terry/code/advent-of-code/advent-of-code-2017/day12/"
;; The file
;; #P"/home/terry/code/advent-of-code/advent-of-code-2017/day12/lisp2/input"
;; does not exist:
;;   No such file or directory
;;    [Condition of type SB-EXT:FILE-DOES-NOT-EXIST]

;;(declaim (optimize (speed 0)(safety 0)(debug 0)(compilation-speed 0)(space 0)))
;;(declaim (optimize (speed 3)(safety 3)(debug 0)(compilation-speed 0)(space 0)))
(declaim (optimize (speed 3)(safety 0)(debug 0)(compilation-speed 0)(space 0)))

#|
after four hours configuring slime and failing
now just use absolute pathnames and forget it

-- AOC 2017 day 12 --

How many programs are in the group that contains program ID 0?

db database

follow all paths from location 0

re is reachable


|#

(defun find-group (at db)
  (let ((met '()))
    (labels ((rec (at db)
	       (setq met (cons at met))
	       (let ((poss (cdr (assoc at db))))
		 (dolist (p poss)
		   (cond
		     ((member p met) nil)
		     (t		      
		      (rec p db)))))))
      (rec at db)
      (sort met #'<))))



(defun all-values (db)
  (let ((all '()))
    (dolist (ass db)
      (dolist (v ass)
	(cond
	  ((member v all) nil)
	  (t (setq all (cons v all))))))
    (sort all #'<)))
      

(defun run ()
  (let ((input (with-open-file (f "/home/terry/code/advent-of-code/advent-of-code-2017/day12/input")
                 (read f))))
    ;; (format t "input length ~a ~%" (length input))
    (solve input)))


#|
 is d in any known group , if so do not need to find find group on that d
|#
(defun solve (db)
  (let ((groups '()))
    (dolist (d (all-values db))
      (catch 'already-seen
      (dolist (g groups)
	(cond
	  ((member d g) (throw 'already-seen t))))      
      (let ((g (find-group d db)))
	(setq groups (cons g groups)))))
    groups))


	       
(defun test ()
  (solve '(
	   (0  2)
	   (1  1)
	   (2  0  3  4)
	   (3  2  4)
	   (4  2  3  6)
	   (5  6)
	   (6  4  5)
	   )))


(defun test2 (n)
  (find-group n
	      '(
		(0  2)
		(1  1)
		(2  0  3  4)
		(3  2  4)
		(4  2  3  6)
		(5  6)
		(6  4  5)
		)))


#|

LISP2> (run)
((1959) (1917) (1902) (1858) (1840) (1828) (1806) (1713) (1710) (1706) (1691)
 (1644 1900) (1572) (1565) (1546) (1543) (1540 1896) (1518) (1483) (1468)
 (1446) (1422) (1387) (1382) (1361 1403) (1305) (1283) (1258) (1236) (1233)
 (1224 1408 1436 1734 1963) (1196 1198 1459 1986) (1194 1838) (1182 1529)
 (1135) (1131 1254 1320 1405 1677 1732 1784) (1121) (1115 1345) (1107) (1103)
 (1077 1971) (1075) (1070) (1054) (1024) (1022) (985 1425) (975) (949 1069)
 (947 966 1181 1702) (940 1417 1437 1884) (925 1957) (899 1592) (881 1146 1526)
 (868 1723) (858 1383 1440 1752 1771) (840 854) (837 1160) (793 1026) (787)
 (781 908 1866) (772 823 826 856 897 1195) (771) (759 1030 1207 1675 1882)
 (738 779 924 1504 1782 1991) (735 1120) (734) (683) (681) (671) (644)
 (636 1435) (632 802) (595) (565 998 1374 1492) (564 658) (563) (551 646 1733)
 (549 1256) (518 1406) (517 519 978 994 1287 1372 1451 1629 1871 1960)
 (472 933 1212 1851) (461 598 1513) (458) (419 607 1310 1798) (414 1602 1687)
 (395 958) (389) (368) (364) (347 1128 1923) (343 1271 1820) (339)
 (338 479 1429 1836) (337 913) (313) (311) (306) (295 453 1012 1525)
 (284 341 392 506 714 953 1444 1770 1830) (281) (262) (259) (253 465 1607 1847)
 (249 1164 1438 1635 1760 1793) (248 464 730 770 1300) (242) (238)
 (236 245 327 608 1191 1354) (220 382)
 (211 265 299 483 538 655 736 795 889 1114 1183 1285 1296 1460 1478 1679 1745)
 (203 257 502 698 1003 1480) (196 593 912 1765) (195 199 1113 1573 1837)
 (180 309 813 988)
 (177 340 370 386 482 610 1108 1129 1173 1187 1238 1293 1466 1477 1528 1570
  1676 1824 1863)
 (169 213 227 274 713 1002 1337 1970) (163)
 (159 186 201 247 308 569 579 592 599 649 678 686 689 740 758 799 825 880 1013
  1088 1156 1225 1255 1269 1289 1340 1342 1377 1465 1481 1693 1846 1999)
 (151) (147) (133 570 1362) (132 827 968 1035 1140 1220 1550 1892 1996)
 (131 870 945 1929)
 (129 158 261 269 361 428 492 641 898 906 916 922 960 1040 1064 1099 1199 1268
  1608 1614 1650 1694 1914 1930 1941 1975)
 (125 234 575 674 956 969 1112 1158 1519 1967)
 (116 219 239 383 507 702 1039 1952) (104)
 (100 348 849 997 1266 1275 1385 1909) (96 241 263 1213 1950)
 (86 378 1015 1318 1535 1671) (85 810 1352)
 (81 118 474 484 665 1138 1282 1815 1911) (79 1042 1086 1155 1471 1835)
 (78 432 677 1079) (75 1153 1226) (67 166 297 476 927 1197 1380 1420 1534 1709)
 (55) (51 115 279 387 403 852 894 1033 1056 1548 1567 1624 1819 1981 1987)
 (50 105 121 144 260 271 352 439 441 450 553 675 833 834 863 930 964 993 1179
  1294 1327 1411 1418 1578 1731 1754 1776 1825 1852 1916 1924)
 (48 92 178 187 316 409 412 425 445 696 776 909 1190 1211 1222 1279 1291 1333
  1335 1366 1370 1421 1433 1491 1542 1557 1755 1813 1944)
 (47 99 426 455 508 618 709 877 1799 1913) (46 251 718 1886) (45 438 1647)
 (44 703 741) (43 83 101 222 746 845 1338 1926)
 (42 56 57 93 150 224 336 349 402 493 552 626 712 724 749 807 819 824 1000 1143
  1250 1260 1297 1353 1453 1580 1615 1689 1973)
 (40 541 896 1170 1939)
 (38 65 84 103 106 108 119 127 139 164 170 176 189 192 229 244 254 258 275 302
  304 318 323 328 356 366 376 397 440 456 471 475 485 489 524 532 559 581 590
  625 631 660 663 670 687 744 761 762 774 778 784 800 809 816 817 853 861 910
  911 914 917 942 951 973 984 996 1014 1032 1034 1038 1059 1061 1082 1090 1123
  1130 1133 1139 1145 1157 1165 1167 1217 1218 1228 1249 1262 1276 1307 1323
  1344 1401 1423 1431 1442 1449 1458 1482 1493 1516 1571 1574 1587 1600 1638
  1643 1661 1669 1701 1729 1749 1763 1768 1800 1834 1850 1859 1875 1881 1893
  1907 1912 1921 1931 1934 1962)
 (37 63 141 143 155 157 165 185 230 355 385 437 597 616 664 755 884 885 905 970
  979 1021 1043 1065 1159 1186 1202 1251 1274 1301 1407 1443 1507 1560 1564
  1576 1652 1692 1707 1826 1920 1936)
 (35 1432 1704 1990)
 (33 197 398 612 739 990 1227 1339 1479 1649 1774 1796 1874 1889 1915 1942)
 (32 52 69 109 117 140 145 161 174 434 443 545 548 580 588 629 791 832 844 882
  907 929 944 967 976 1019 1020 1037 1083 1119 1192 1216 1347 1373 1398 1464
  1467 1489 1562 1569 1575 1579 1588 1657 1751 1801 1822 1844 1964 1982 1988)
 (30 182 379 501 699 1563 1595 1700)
 (28 88 94 148 179 214 215 225 243 288 296 298 320 360 367 393 401 408 547 601
  605 697 701 711 763 790 796 851 869 886 903 974 983 1006 1029 1048 1081 1100
  1116 1117 1178 1235 1315 1331 1381 1384 1396 1450 1462 1463 1476 1514 1553
  1585 1604 1617 1619 1632 1662 1684 1697 1746 1775 1792 1856 1867 1935 1955
  1966 1979)
 (26 31 68 134 191 218 273 287 384 459 495 500 555 556 566 767 775 792 806 867
  875 982 992 1053 1094 1184 1270 1329 1457 1490 1598 1603 1605 1656 1686 1698
  1718 1719 1738 1780 1810 1983 1993)
 (24 986)
 (20 64 87 152 154 156 209 216 231 232 276 310 312 314 326 345 351 358 359 363
  365 372 373 375 423 462 478 488 527 535 557 561 567 585 587 609 617 624 627
  666 754 756 765 768 801 808 821 828 876 878 934 937 943 980 1008 1009 1017
  1025 1047 1050 1058 1066 1110 1166 1206 1223 1247 1248 1272 1277 1278 1298
  1304 1313 1321 1324 1328 1334 1355 1357 1358 1397 1441 1452 1455 1495 1505
  1508 1511 1515 1541 1566 1613 1659 1688 1711 1717 1739 1743 1786 1803 1805
  1807 1808 1811 1849 1860 1865 1873 1879 1888 1894 1898 1933 1947 1949 1980
  1984 1989 1994)
 (19 29 34 283 285 353 451 487 510 562 571 600 602 606 656 672 676 700 725 751
  764 783 811 815 846 866 872 987 1011 1148 1151 1210 1230 1306 1445 1590 1648
  1683 1722 1766 1773 1781 1787 1814 1845 1885 1937)
 (18 21 22 53 59 61 62 66 72 73 76 80 90 107 112 113 120 122 126 136 171 175
  190 198 208 226 250 256 267 270 280 289 291 292 300 303 321 329 331 333 346
  357 377 388 400 405 422 436 442 448 460 473 477 486 491 494 516 522 529 540
  546 550 582 583 584 586 614 619 621 630 635 638 659 661 673 679 684 685 690
  694 716 719 729 732 737 747 760 773 777 788 803 804 829 831 855 857 862 864
  901 902 904 918 920 923 931 957 989 1007 1046 1062 1071 1074 1092 1096 1097
  1098 1101 1102 1106 1118 1126 1136 1141 1150 1161 1163 1180 1201 1229 1234
  1239 1241 1246 1261 1267 1280 1284 1319 1332 1359 1360 1364 1367 1378 1379
  1390 1392 1412 1426 1427 1472 1517 1520 1551 1555 1601 1606 1609 1622 1626
  1633 1665 1672 1674 1678 1680 1681 1682 1705 1712 1716 1721 1724 1757 1762
  1772 1778 1779 1788 1791 1795 1812 1829 1857 1861 1876 1891 1903 1927 1940
  1943 1953 1954 1977 1985 1992)
 (14 204 369 427 509 514 534 539 693 706 721 752 850 887 936 952 981 1055 1124
  1147 1177 1312 1326 1413 1430 1532 1537 1568 1596 1621 1627 1655 1673 1747
  1764 1854 1974 1997)
 (13 111 334 457 544 640 890 999 1004 1797) (12 1748)
 (11 16 60 91 98 135 172 183 205 207 228 246 272 315 317 319 407 411 416 417
  433 526 531 537 543 558 572 603 613 615 657 705 742 743 745 785 818 838 839
  842 843 859 873 900 921 946 955 962 963 965 971 977 991 995 1001 1028 1036
  1063 1068 1137 1142 1144 1154 1185 1193 1200 1281 1286 1288 1303 1308 1341
  1346 1348 1351 1365 1375 1415 1484 1485 1488 1494 1506 1556 1583 1586 1611
  1620 1623 1637 1642 1695 1699 1736 1761 1767 1802 1821 1827 1848 1870 1887
  1899 1945 1978)
 (9 847 1922 1928) (8 149 188 594 692 726 728 1084 1125 1376 1612 1630 1877)
 (6 7 17 23 25 27 39 58 71 89 95 110 123 124 130 138 146 153 160 162 168 173
  181 184 206 210 221 235 237 240 252 255 266 278 286 290 301 324 335 371 380
  391 396 406 415 421 424 429 435 452 466 480 481 505 512 515 520 530 554 560
  596 611 620 622 628 634 639 643 648 650 651 654 662 682 688 704 715 720 723
  731 733 748 750 753 769 782 789 798 805 830 841 860 865 879 892 895 939 941
  948 950 959 1023 1044 1049 1052 1057 1060 1073 1076 1087 1095 1104 1105 1111
  1122 1132 1134 1172 1176 1203 1204 1205 1214 1221 1232 1243 1244 1259 1263
  1273 1295 1314 1316 1336 1356 1368 1388 1389 1391 1394 1395 1399 1414 1416
  1419 1424 1434 1439 1448 1456 1470 1473 1474 1487 1496 1497 1498 1499 1500
  1503 1522 1523 1524 1527 1531 1536 1554 1577 1582 1593 1610 1616 1625 1634
  1660 1663 1667 1703 1714 1727 1737 1741 1744 1753 1756 1758 1759 1777 1783
  1789 1790 1794 1804 1809 1816 1817 1818 1823 1839 1853 1862 1868 1897 1901
  1904 1910 1918 1938 1948 1956 1958 1965 1968 1972 1995 1998)
 (3 10 217 410 418 446 503 523 525 533 836 961 1005 1018 1264 1447 1521 1628
  1726)
 (2 5 15 36 54 74 77 102 114 128 137 142 193 194 200 202 212 233 268 277 282
  293 305 307 322 325 342 354 381 390 399 413 447 449 454 497 498 499 504 511
  513 521 573 574 578 591 623 633 642 647 680 691 710 722 766 780 786 794 835
  871 874 888 891 932 954 972 1067 1080 1089 1091 1109 1127 1162 1169 1188 1189
  1215 1231 1252 1253 1257 1290 1292 1299 1309 1311 1317 1325 1330 1349 1363
  1428 1454 1509 1510 1512 1530 1538 1539 1545 1552 1559 1561 1581 1591 1597
  1640 1641 1651 1653 1654 1668 1670 1690 1708 1720 1728 1769 1832 1842 1855
  1869 1880 1883 1895 1906 1908 1925 1932 1946 1961 1969 1976)
 (1 41 97 757 883 928 1402 1905)
 (0 4 49 70 82 167 223 264 294 330 332 344 350 362 374 394 404 420 430 431 444
  463 467 468 469 470 490 496 528 536 542 568 576 577 589 604 637 645 652 653
  667 668 669 695 707 708 717 727 797 812 814 820 822 848 893 915 919 926 935
  938 1010 1016 1027 1031 1041 1045 1051 1072 1078 1085 1093 1149 1152 1168
  1171 1174 1175 1208 1209 1219 1237 1240 1242 1245 1265 1302 1322 1343 1350
  1369 1371 1386 1393 1400 1404 1409 1410 1461 1469 1475 1486 1501 1502 1533
  1544 1547 1549 1558 1584 1589 1594 1599 1618 1631 1636 1639 1645 1646 1658
  1664 1666 1685 1696 1715 1725 1730 1735 1740 1742 1750 1785 1831 1833 1841
  1843 1864 1872 1878 1890 1919 1951))
LISP2> (length (run))
171
LISP2> 

LISP2> (test)
((1) (0 2 3 4 5 6))

LISP2> test has 2 groups as required

LISP2> (time (progn (run) 'done))
Evaluation took:
  0.016 seconds of real time
  0.018269 seconds of total run time (0.018269 user, 0.000000 system)
  112.50% CPU
  67,378,017 processor cycles
  196,512 bytes consed
  
DONE
LISP2>
0.016 to 0.024 noise ...


|#
